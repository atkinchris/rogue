!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,n){(function(t){var n,o=t.crypto||t.msCrypto;if(o&&o.getRandomValues){var r=new Uint8Array(16);n=function(){return o.getRandomValues(r),r}}if(!n){var a=new Array(16);n=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}e.exports=n}).call(t,n(7))},function(e,t){function n(e,t){var n=t||0,r=o;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]}for(var o=[],r=0;r<256;++r)o[r]=(r+256).toString(16).substr(1);e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t){var n=e.createEntity();return e.addComponent(n,"position",t),e.addComponent(n,"tile",{character:"@",layer:2}),e.addComponent(n,"playerControlled"),e.addComponent(n,"collides"),e.addComponent(n,"canAttack"),n},r=function(e,t){var n=e.createEntity();return e.addComponent(n,"position",t),e.addComponent(n,"tile",{character:"K",layer:2}),e.addComponent(n,"collides"),e.addComponent(n,"health",{value:3}),n},a=function(e,t){var n=e.createEntity();return e.addComponent(n,"position",t),e.addComponent(n,"tile",{character:"#"}),e.addComponent(n,"collides"),n},i=function(e,t){var n=e.createEntity();return e.addComponent(n,"position",t),e.addComponent(n,"tile",{character:"."}),n},c=function(e,t){var n=e.createEntity();return e.addComponent(n,"position",t),e.addComponent(n,"tile",{character:"✝",layer:1}),n};t.createPlayer=o,t.createEnemy=r,t.createWall=a,t.createFloor=i,t.createGravestone=c},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}var r=n(4),a=o(r),i=n(9),c=o(i),u=n(20),f=o(u),s=n(21),l=o(s),d=n(22),v=o(d),p=n(23),m=o(p);n(24);var h=new a.default;(0,l.default)(function(e){h.setCache("playerIntent",{type:"move",direction:e}),(0,f.default)(h,c.default)}),(0,v.default)(h),(0,f.default)(h,c.default),(0,m.default)()},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(5),i=function(){function e(){o(this,e),this.entities={},this.components={},this.caches={}}return r(e,[{key:"createEntity",value:function(){var e=(0,a.v4)();return this.entities[e]=!0,e}},{key:"removeEntity",value:function(e){var t=this;this.entities[e]=null,Object.keys(this.components).forEach(function(n){return t.removeComponent(e,n)})}},{key:"setCache",value:function(e,t){this.caches[e]=t}},{key:"getCache",value:function(e){return this.caches[e]}},{key:"addComponent",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.components[t]||(this.components[t]={}),this.components[t][e]=n}},{key:"removeComponent",value:function(e,t){this.components[t]||(this.components[t]={}),this.components[t][e]=null}},{key:"getEntitiesWith",value:function(e){var t=this;return Object.keys(this.entities).filter(function(n){return e.every(function(e){return t.getComponent(n,e)})})}},{key:"getComponent",value:function(e,t){return this.components[t]&&this.components[t][e]}},{key:"debugComponents",value:function(){console.log(this.components)}}]),e}();t.default=i},function(e,t,n){var o=n(6),r=n(8),a=r;a.v1=o,a.v4=r,e.exports=a},function(e,t,n){function o(e,t,n){var o=t&&n||0,r=t||[];e=e||{};var i=void 0!==e.clockseq?e.clockseq:u,l=void 0!==e.msecs?e.msecs:(new Date).getTime(),d=void 0!==e.nsecs?e.nsecs:s+1,v=l-f+(d-s)/1e4;if(v<0&&void 0===e.clockseq&&(i=i+1&16383),(v<0||l>f)&&void 0===e.nsecs&&(d=0),d>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");f=l,s=d,u=i,l+=122192928e5;var p=(1e4*(268435455&l)+d)%4294967296;r[o++]=p>>>24&255,r[o++]=p>>>16&255,r[o++]=p>>>8&255,r[o++]=255&p;var m=l/4294967296*1e4&268435455;r[o++]=m>>>8&255,r[o++]=255&m,r[o++]=m>>>24&15|16,r[o++]=m>>>16&255,r[o++]=i>>>8|128,r[o++]=255&i;for(var h=e.node||c,y=0;y<6;++y)r[o+y]=h[y];return t||a(r)}var r=n(0),a=n(1),i=r(),c=[1|i[0],i[1],i[2],i[3],i[4],i[5]],u=16383&(i[6]<<8|i[7]),f=0,s=0;e.exports=o},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){function o(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var i=e.random||(e.rng||r)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var c=0;c<16;++c)t[o+c]=i[c];return t||a(i)}var r=n(0),a=n(1);e.exports=o},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),a=o(r),i=n(11),c=o(i),u=n(12),f=o(u),s=n(13),l=o(s),d=n(14),v=o(d),p=n(15),m=o(p),h=n(16),y=o(h),g=n(17),C=o(g),b=n(18),w=o(b),E=n(19),_=o(E);t.default=[(0,m.default)(),(0,c.default)(),(0,l.default)(),(0,y.default)(),(0,v.default)(),(0,f.default)(),(0,C.default)(),(0,w.default)(),(0,_.default)(),(0,a.default)()]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){var e=document.getElementById("canvas"),t=e.getContext("2d"),n=[];return e.width=200,e.height=200,function(o){var r=o.getEntitiesWith(["tile","position"]);t.clearRect(0,0,e.width,e.height),n.forEach(function(t){t.getContext("2d").clearRect(0,0,e.width,e.height)}),r.forEach(function(t){var r=o.getComponent(t,"tile"),a=o.getComponent(t,"position"),i=20*a.x,c=20*a.y,u=r.layer,f=void 0===u?0:u;n[f]||(n[f]=e.cloneNode());var s=n[f].getContext("2d");s.fillStyle="black",s.fillRect(i,c,20,20),s.font="20px monospace",s.fillStyle="white",s.fillText(r.character,i,c+20),s.restore()}),n.forEach(function(e){t.drawImage(e,0,0)})}};t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){return function(e,t){var n=e.getCache("playerIntent");n&&n.type?e.getEntitiesWith(["playerControlled"]).forEach(function(o){switch(n.type){case"move":e.addComponent(o,"moveIntent",n);break;default:t("Invalid intent from ",o)}}):t("No intent found"),e.setCache("playerIntent",null)}};t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){return function(e){e.getEntitiesWith(["moveIntent","position"]).forEach(function(t){var n=e.getComponent(t,"moveIntent");e.addComponent(t,"position",n),e.removeComponent(t,"moveIntent")})}};t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){return function(e,t){e.getEntitiesWith(["moveIntent","position"]).forEach(function(n){var o=e.getComponent(n,"moveIntent"),r=e.getComponent(n,"position"),a=r.x,i=r.y,c={x:a,y:i};switch(o.direction){case"down":c.y+=1;break;case"up":c.y-=1;break;case"left":c.x-=1;break;case"right":c.x+=1;break;default:t("Invalid movement direction",n)}e.addComponent(n,"moveIntent",c)})}};t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){return function(e){var t=e.getEntitiesWith(["moveIntent","collides"]),n=e.getCache("collisions");t.forEach(function(t){var o=e.getComponent(t,"moveIntent"),r=o.x,a=o.y;n[r+","+a]&&e.removeComponent(t,"moveIntent")})}};t.default=o},function(e,t,n){"use strict";function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},a=function(){return function(e){var t=e.getEntitiesWith(["collides","position"]),n=t.reduce(function(t,n){var a=e.getComponent(n,"position"),i=a.x,c=a.y;return r({},t,o({},i+","+c,n))},{});e.setCache("collisions",n)}};t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){return function(e){var t=e.getEntitiesWith(["moveIntent","collides","canAttack"]),n=e.getCache("collisions");t.forEach(function(t){var o=e.getComponent(t,"moveIntent"),r=o.x,a=o.y,i=n[r+","+a];i&&e.getComponent(i,"health")&&(e.removeComponent(t,"moveIntent"),e.addComponent(t,"attackIntent",{target:i}))})}};t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){return function(e){e.getEntitiesWith(["attackIntent"]).forEach(function(t){var n=e.getComponent(t,"attackIntent"),o=n.target;e.addComponent(o,"receiveDamage",1),e.removeComponent(t,"attackIntent")})}};t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){return function(e){e.getEntitiesWith(["receiveDamage"]).forEach(function(t){var n=e.getComponent(t,"receiveDamage"),o=e.getComponent(t,"health"),r=o.value;e.addComponent(t,"health",{value:r-n}),e.removeComponent(t,"receiveDamage")})}};t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),r=function(){return function(e){e.getEntitiesWith(["health"]).forEach(function(t){var n=e.getComponent(t,"health"),r=e.getComponent(t,"position");n&&n.value<0&&(e.removeEntity(t),r&&(0,o.createGravestone)(e,r))})}};t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e,t){for(var n=e.getCache("debug"),o=!0,r=0,a=function(e){n&&console.warn(e),o=!1};o;)r+=1,r>10&&a("Iteration limit reached"),t.forEach(function(t){return t(e,a)})};t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){var t=function(t){if(t&&!t.repeat)switch(t.code){case"KeyW":case"ArrowUp":e("up");break;case"KeyS":case"ArrowDown":e("down");break;case"KeyA":case"ArrowLeft":e("left");break;case"KeyD":case"ArrowRight":e("right")}};return window.addEventListener("keydown",t),function(){return window.removeEventListener("keydown",t)}};t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),r=["          "," ######## ","##......# ","#...@...# ","#.......# ","##....K.##"," #.......#"," #########"],a=function(e){return r.forEach(function(t,n){t.split("").forEach(function(t,r){switch(t){case"@":(0,o.createPlayer)(e,{x:r,y:n}),(0,o.createFloor)(e,{x:r,y:n});break;case"#":(0,o.createWall)(e,{x:r,y:n});break;case".":(0,o.createFloor)(e,{x:r,y:n});break;case"K":(0,o.createEnemy)(e,{x:r,y:n}),(0,o.createFloor)(e,{x:r,y:n})}})})};t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight"},r=function(e){return function(){var t=new Event("keydown");t.code=e,window.dispatchEvent(t)}},a=function(){Object.keys(o).forEach(function(e){document.getElementById(e+"-button").addEventListener("click",r(o[e]))})};t.default=a},function(e,t){}]);
//# sourceMappingURL=main.d15a88ea.js.map